# 9. 스케줄링 알고리즘과 우선순위

- 일반 OS - 범용적인 사용을 위하여 디자인되어있음(Windows, Linux 등)
- RTOS(RealTime OS) - 사용하는 영역이 제한적임 -> 프로그래머가 시키지 않은 일은 하지 않음.
- RTOS는 사용되는 목적이 구체적이고 제한적이다 보니, 보다 단순하게 디자인되어있고 일반 OS에 비해 훨씬 가벼움. 따라서 **응답성**이 좋음
- OS의 구분(응답성) - 범용 OS와 RTOS

### Soft RTOS vs Hard RTOS

Soft RTOS - 위에서 설명한 RTOS는 Soft ROTS에 대한 설명임.

Hard RTOS - 자동차의 ABS시스템과 같이 시간에 크리티컬하여 데드라인이 중요한 시스템에서 이를 충족시킬 수 있는 능력을 지니는 RTOS. CPU의 속도가 빠르다고 해서 만족되지 않기 때문에 디자인이 어렵고 일반 OS와 전혀 다른 알고리즘으로 스케줄러가 디자인됨

### 선점형 OS와 비선점형 OS

- OS의 구분(프로세스의 실행을 다른 프로세스로 넘기는 방식) - 선점형 OS와 비선점형 OS
- 비선점형 OS - 현재 실행중인 프로세스보다 높은 우선순위의 프로세스가 등장한다고 해서 실행의 대상을 바로 변경하지 않음. 새로 등장한, 보다 높은 우선순위의 프로세스가 실행되기 위해서는 현재 실행 중인 프로세스가 명시적으로 CPU를 양보할 때까지, 혹은 I/O 작업 등으로 블로킹 상태에 놓일 때까지 기다려야 함
- 비선점형 OS - 인터렉티브한 프로그램 구현 시 프로그래머 의존도가 높아짐(자신이 개발한 프로그램이 CPU를 독차지않도록 신경써서 프로그래밍 해야 함)
- 선점형 OS - 현재 실행 중인 프로세스보다 높은 우선순위의 프로세스가 등장하면 스케줄러에 의한 실행순서 조정이 가해짐.
- 선점형 OS - 스케줄러가 실행순서를 조정하기 때문에 스케줄러가 하는 일이 많아지고 멀티 프로세스 기반 OS에 적합.(스케줄러에 의해서 실행순서가 조정되어 프로그래머가 신경쓸 일이 거의 없어짐)

### 우선순위 스케줄링 알고리즘

각각의 프로세스마다 우선순위를 부여해서 우선순위가 높은 프로세스를 먼저 실행시키는 방식

- 기아(Starvation)상태 - 우선순위가 낮은 프로세스는 우선순위가 높은 프로세스가 실행중인 동안 실행이 안되는 상태
- 그러나, 높은 우선순위의 프로세스가 I/O관련 작업을 하는 과정에서, 낮은 우선순위 프로세스가 실행 기회를 얻을 수 있음
- 대부분의 프로그램이 상당 시간을 I/O에 할애하게끔 되어있어 기아 상태는 거의 발생하지 않는다.

### 라운드 로빈 스케줄링 알고리즘

- 우선순위 스케줄링 알고리즘은 우선순위가 동일한 프로세스의 경우에 형평성의 문제가 발생하게 됨
- 라운드 로빈 스케줄링 알고리즘 - 같은 우선순위의 프로세스들간 형평성 유지를 위해, 정해진 시간 간격만큼만 실행을 하고 우선순위가 동일한 다른 프로세스에게 CPU의 할당을 넘기는 방식을 제공
- 실행의 최소 시간 단위 - 퀀텀 or 타임 슬라이스
- 동일한 우선순위의 모든 프로세스들은 타임 슬라이스를 기준으로 CPU의 할당을 넘기게 됨
- 타임 슬라이스를 길게 할 경우 - 인터렉티브한 시스템에서 문제가 발생(입력에 대한 반응이 늦을 수 있음)
- 타임 슬라이스를 짧게 할 경우 - 컨텍스트 스위칭이 자주 발생해서 성능에 저하를 가져옴

### 스케줄링 알고리즘에 의해서 스케줄링이 진행되는 시점

- 프로세스의 실행시간 간격에 해당하는 매 타임 슬라이스마다(라운드 로빈 방식 관점 - 실행순서를 넘겨야 하므로)
- 새 프로세스가 생성될 때 or 종료될 때(우선순위 스케줄링관점 - 우선순위를 비교해야 하므로)
- 현재 실행 중인 프로세스가 블로킹 상태에 놓일 때마다(블로킹 상태가 되면 다른 프로세스가 대신 실행되므로)

### Priority Inversion

프로세스의 우선순위가 뒤바뀌는 현상

Ex) A > B > C의 순서로 우선순위를 가진 프로세스가 있음. A는 C의 리턴값이 필요해서 Blocking에 들어갔으나 B가 실행되어 C는 실행되지 못하여 발생하는 문제



## Windows 프로세스 우선순위

Windows는 총 6단계의 우선순위 계층을 제공

| Priority                    | Meaning                                  |
| --------------------------- | ---------------------------------------- |
| IDLE_PRIORITY_CLASS         | 기존 우선순위 4                                |
| NORMAL_PRIORITY_CLASS       | 기존 우선순위 9                                |
| HIGH_PRIORITY_CLASS         | 기존 우선순위 13                               |
| REALTIME_PRIORITY_CLASS     | 기존 우선순위 24                               |
| ABOVE_NORMAL_PRIORITY_CLASS | NORMAL_PRIORITY_CLASS보다 높고 HIGH_PRIORITY_CLASS보다 낮은 우선순위 |
| BELOW_NORMAL_PRIORITY_CLASS | IDLE_PRIORITY_CLASS보다 높고 NORMAL_PRIORITY_CLASS보다 낮은 우선순위 |

