# 6. 커널 오브젝트와 오브젝트 핸들

- 커널 - 컴퓨터를 운영하는 데 있어서 중심이 되는 운영체제 핵심 부분



## 커널 오브젝트

- 커널에서 관리하는 중요한 정보를 담아둔 데이터 블록
- Windows운영체제가 프로세스, 스레드 혹은 파일과 같은 리소스들을 원활이 관리하기 위해 필요한 정보를 저장해야 함. 이 때 데이터를 저장하는 메모리 블록을 가리켜 커널 오브젝트라 함
- 파이프 커널 오브젝트 -> 파이프 관리
- 프로세스 커널 오브젝트 -> 프로세스 관리
- 스레드 커널 오브젝트 -> 스레드 관리



## 오브젝트 핸들을 이용한 커널 오브젝트 조작

- 프로그래머가 직접 커널 오브젝트를 조작하는 것은 불가능
- 그러나, 함수 호출에 의한 간접적인 조작은 가능
- 핸들 - 커널 오브젝트에 할당되는 숫자
- Windows는 커널 오브젝트를 생성할 때마다 핸들을 하나씩 부여함
- HANDLE <-> Kernal Object <-> Resource의 구조
- 커널 오브젝트 -> 운영체제에 종속적
- 핸들 -> 프로세스에 종속적
- CloseHandle - 프로세스가 소멸된다고 커널 오브젝트가 소멸되는건 아님(운영체제가 정하기 때문). 따라서 이처럼 핸들을 반환하는 함수를 따로 제공
- 자식 프로세스의 종료코드는 자식 프로세스의 커널 오브젝트에 저장됨

### 프로세스 핸들과 ID의 차이

- 핸들 - 프로세스의 커널 오브젝트를 구분하기 위한 것
- ID - 커널 오브젝트가 아니라 프로세스 자체를 구분짓기 위한 것



## 커널 오브젝트와 Usage Count

- 자식 프로세스의 종료코드는 자식 프로세스의 커널 오브젝트에 저장됨. 따라서, 자식 프로세스가 종료될 때 커널 오브젝트도 동시에 소멸된다면 부모 프로세스는 종료코드를 얻을 수 없음. -> 프로세스가 종료된다고 커널 오브젝트까지 동시에 소멸시키지는 않음
- 커널 오브젝트 소멸 시점 - 커널 오브젝트를 참조하는 대상이 하나도 없을 때 소멸시키는 것이 이상적. Windows가 이렇게 작동.
- Usage Count - 커널 오브젝트를 참조하는 대상의 개수
- Usage Count가 0이 되면 운영체제는 해당 커널 오브젝트를 소멸시킴.
- CloseHandle -> 핸들을 반환하면서 커널 오브젝트의 Usage Count를 1 감소시킴.(커널 오브젝트 삭제가 아님!!), 주로 부모 프로세스에서 실행!